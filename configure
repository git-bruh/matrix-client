#!/usr/bin/env sh

set -e

fail() {
	echo "$1"
	exit 1
}

CFLAGS="-g3"
LDFLAGS=
LDLIBS=
PREFIX=/usr/local

for arg; do
	case "$arg" in
	--prefix=*)
		PREFIX=${arg#*=}
	;;
	--enable-sanitize*)
		CFLAGS="$CFLAGS -fsanitize=address,undefined -fno-omit-frame-pointer"
	;;
	--enable-static*)
		LDFLAGS="-static"
		LDLIBS="$(curl-config --static-libs)"
	;;
	*)
		fail "Unknown Option '$arg'"
	;;
	esac
done

cat > config.mk << EOF
CC = ${CC:-cc}
CFLAGS += $CFLAGS
LDFLAGS += $LDFLAGS
LDLIBS += $LDLIBS
PREFIX = $PREFIX
EOF
